<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Programming Review — Python Basics</title>
    <link rel="icon" href="data:,">
    <style>
        :root {
            --bg: #0f172a;
            --panel: #111827;
            --panel2: #0b1224;
            --text: #f8fafc;
            --muted: #cbd5e1;
            --acc: #60a5fa;
            --ok: #22c55e;
            --warn: #f59e0b;
            --bad: #ef4444;
            --ink: #0b1224;
            /* Runner sizing */
            --runner-min: 280px;
            --runner-max: 440px;
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg: #ffffff;
                --panel: #f8fafc;
                --panel2: #eef2ff;
                --text: #0b1224;
                --muted: #475569;
                --acc: #2563eb;
                --ok: #16a34a;
                --warn: #d97706;
                --bad: #dc2626;
                --ink: #ffffff;
            }
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: Segoe UI, Inter, system-ui, Arial, sans-serif;
            background:
                radial-gradient(1000px 700px at 15% -10%, var(--panel2), transparent), var(--bg);
            color: var(--text)
        }

        .wrap {
            max-width: 1080px;
            margin: 0 auto;
            padding: 20px 14px 60px
        }

        h1 {
            margin: 0 0 4px;
            font-size: 28px
        }

        .sub {
            color: var(--muted);
            margin: 0 0 12px
        }

        .bar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin: 10px 0 14px
        }

        .tab {
            border: 1px solid rgba(255, 255, 255, .15);
            background: var(--panel);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer
        }

        .tab.active {
            background: var(--acc);
            color: #081225;
            border-color: transparent;
            font-weight: 700
        }

        select,
        input,
        button {
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, .15);
            padding: 8px 10px;
            background: #0b1224;
            color: #e5e7eb
        }

        button {
            background: var(--acc);
            color: #081225;
            border: 0;
            cursor: pointer;
            font-weight: 700
        }

        button.ghost {
            background: transparent;
            color: var(--acc);
            border: 1px solid var(--acc)
        }

        .pill {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            background: #0b1224;
            border: 1px solid rgba(255, 255, 255, .12);
            color: #cbd5e1;
            font-size: 12px
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(0, 0, 0, .08)), var(--panel);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 14px;
            padding: 14px 14px 12px;
            box-shadow: 0 10px 26px rgba(0, 0, 0, .25);
            margin-top: 12px
        }

        .row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        .list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 8px
        }

        .item {
            background: #0b1224;
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 12px;
            padding: 10px
        }

        .item h3 {
            margin: 0;
            font-size: 16px
        }

        .muted {
            color: var(--muted);
            font-size: 13px
        }

        .hide {
            display: none
        }

        pre {
            background: #0b1224;
            border: 1px solid rgba(255, 255, 255, .1);
            padding: 10px;
            border-radius: 10px;
            overflow: auto
        }

        code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
            font-size: 13px
        }

        .good {
            color: var(--ok)
        }

        .bad {
            color: var(--bad)
        }

        /* Flashcards */
        .fcBox {
            background: #0b1224;
            border: 1px dashed rgba(255, 255, 255, .18);
            border-radius: 14px;
            padding: 24px;
            min-height: 160px;
            cursor: pointer
        }

        .center {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center
        }

        .term {
            font-size: 22px;
            font-weight: 800
        }

        .defBig {
            font-size: 15px
        }

        /* Matching */
        .cols {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px
        }

        .col {
            display: grid;
            gap: 8px
        }

        .chip {
            background: #0b1224;
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 10px;
            padding: 10px;
            cursor: pointer
        }

        .chip.sel {
            outline: 2px solid var(--acc)
        }

        .chip.ok {
            background: rgba(34, 197, 94, .15);
            border-color: rgba(34, 197, 94, .5)
        }

        /* Quiz */
        .q {
            margin-top: 8px
        }

        .opt {
            display: flex;
            gap: 8px;
            align-items: center;
            background: #0b1224;
            border: 1px solid rgba(255, 255, 255, .1);
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer
        }

        .opt input {
            accent-color: var(--acc)
        }

        /* Do not rely on color alone for correctness cues */
        .opt.good {
            border-color: var(--ok);
            box-shadow: inset 0 0 0 2px var(--ok);
            position: relative;
        }

        .opt.good::before {
            content: "✓";
            color: var(--ok);
            font-weight: 800;
            margin-right: 6px;
        }

        .opt.bad {
            border-color: var(--bad);
            box-shadow: inset 0 0 0 2px var(--bad);
            position: relative;
        }

        .opt.bad::before {
            content: "✗";
            color: var(--bad);
            font-weight: 800;
            margin-right: 6px;
        }

        .chip.bad {
            outline: 2px solid var(--bad);
        }

        .chip.ok::after {
            content: "✓";
            float: right;
            color: var(--ok);
            font-weight: 800;
        }

        /* Runner */
        textarea.runner {
            width: 100%;
            height: clamp(160px, 32vh, 320px);
            /* fit on screen */
            background: #0b1224;
            border: 1px solid rgba(255, 255, 255, .1);
            color: #e5e7eb;
            border-radius: 10px;
            padding: 10px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
            font-size: 13px;
            resize: vertical;
            /* user can resize if needed */
        }

        /* Right sidebar layout: runner on the right (desktop), stacked on mobile */
        @media (min-width: 1024px) {
            main.wrap {
                display: grid;
                grid-template-columns: 1fr clamp(var(--runner-min), 34vw, var(--runner-max));
                gap: 16px;
                align-items: start;
            }

            /* Put everything except #runner in the left column */
            .wrap> :not(#runner):not(style) {
                grid-column: 1;
            }

            /* Runner sticks on the right */
            #runner {
                grid-column: 2;
                position: sticky;
                top: 12px;
                max-height: calc(100vh - 24px);
                overflow: auto;
            }
        }

        /* Improve stacked behavior on tablets/phones */
        @media (max-width: 1023px) {
            #runner {
                position: static;
                /* avoid sticky jumps on mobile */
                max-height: none;
                /* let inner areas scroll */
            }
        }

        /* Theme overrides (placed after base styles for precedence) */
        /* Explicit Dark */
        body[data-theme="dark"] {
            --bg: #0f172a;
            --panel: #111827;
            --panel2: #0b1224;
            --text: #f8fafc;
            --muted: #cbd5e1;
            --acc: #60a5fa;
            --ok: #22c55e;
            --warn: #f59e0b;
            --bad: #ef4444;
            --ink: #0b1224;
        }

        /* Explicit Light */
        body[data-theme="light"] {
            --bg: #ffffff;
            --panel: #f8fafc;
            --panel2: #eef2ff;
            --text: #0b1224;
            --muted: #475569;
            --acc: #2563eb;
            --ok: #16a34a;
            --warn: #d97706;
            --bad: #dc2626;
            --ink: #ffffff;
        }

        /* Colorblind-safe (uses blue/orange pair; avoids red/green reliance) */
        body[data-theme="cb"] {
            --bg: #101418;
            --panel: #141b22;
            --panel2: #0e1522;
            --text: #f5f7fa;
            --muted: #c7d0db;
            --acc: #3aa3ff;
            --ok: #1f77b4;
            /* blue */
            --warn: #ffbf50;
            /* amber */
            --bad: #ff7f0e;
            /* orange */
            --ink: #0b1224;
        }

        /* High contrast (dark) */
        body[data-theme="hc"] {
            --bg: #000;
            --panel: #0a0a0a;
            --panel2: #000;
            --text: #fff;
            --muted: #ddd;
            --acc: #ff0;
            --ok: #0ff;
            --warn: #ff0;
            --bad: #f0f;
            --ink: #000;
        }

        /* Ensure adequate contrast for option blocks in all themes */
        .opt {
            background: color-mix(in oklab, var(--panel) 92%, black 8%);
        }

        body[data-theme="light"] .opt {
            background: color-mix(in oklab, var(--panel) 92%, white 8%);
        }

        body[data-theme="hc"] .opt {
            background: #000;
            border-color: #fff;
        }

        body[data-theme="hc"] .opt.good {
            box-shadow: inset 0 0 0 3px var(--ok);
        }

        body[data-theme="hc"] .opt.bad {
            box-shadow: inset 0 0 0 3px var(--bad);
        }
    </style>
    <!-- Pyodide runtime for in-browser Python -->
    <script defer src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>

<body>
    <main class="wrap">
        <h1>Programming Review — Python Basics</h1>
        <div class="sub">Study key concepts with examples, flashcards, matching, and a quick quiz. Units: Basics &
            Console, Conditionals, Looping, Functions & Exceptions.</div>

        <div class="bar">
            <button class="tab active" data-mode="study">Study</button>
            <button class="tab" data-mode="flash">Flashcards</button>
            <button class="tab" data-mode="match">Matching</button>
            <button class="tab" data-mode="quiz">Quiz</button>
            <select id="unitFilter" title="Filter by unit">
                <option value="all" selected>All Units</option>
                <option value="basics">Basics & Console</option>
                <option value="conds">Conditionals</option>
                <option value="loops">Looping</option>
                <option value="funcs">Functions & Exceptions</option>
            </select>
            <select id="themeSelect" title="Theme">
                <option value="system" selected>Theme: System</option>
                <option value="light">Theme: Light</option>
                <option value="dark">Theme: Dark</option>
                <option value="cb">Theme: Colorblind Safe</option>
                <option value="hc">Theme: High Contrast</option>
            </select>
            <span class="pill" id="countPill">0 items</span>
        </div>

        <!-- Study -->
        <section id="study" class="card">
            <div class="row">
                <input id="search" type="search" placeholder="Search terms, definitions, or code..."
                    aria-label="Search" />
                <button class="ghost" id="expandAll">Expand All</button>
                <button class="ghost" id="collapseAll">Collapse All</button>
            </div>
            <div class="list" id="studyList"></div>
        </section>

        <!-- Flashcards -->
        <section id="flash" class="card hide">
            <div class="row">
                <button id="prev">Prev</button>
                <button id="flip">Flip (F)</button>
                <button id="next">Next</button>
                <button class="ghost" id="shuffle">Shuffle</button>
                <span class="pill" id="fcProg">1 / 1</span>
                <span class="pill" id="gotPill">Got it: 0</span>
            </div>
            <div class="fcBox center" id="fcBox" tabindex="0" aria-live="polite">
                <div id="front" class="term"></div>
                <div id="back" class="defBig hide"></div>
            </div>
            <div class="row">
                <button id="gotIt" title="Mark this card as learned">I got this ✅</button>
                <button class="ghost" id="resetGot">Reset learned</button>
            </div>
        </section>

        <!-- Matching -->
        <section id="match" class="card hide">
            <div class="row">
                <button id="newRound">New Round</button>
                <span class="pill" id="matchLeft">Pairs left: 0</span>
            </div>
            <div class="cols">
                <div class="col" id="leftCol"></div>
                <div class="col" id="rightCol"></div>
            </div>
            <div class="muted" style="margin-top:8px">Click one term and the matching definition.</div>
        </section>

        <!-- Quiz -->
        <section id="quiz" class="card hide">
            <div class="row">
                <select id="quizCount">
                    <option>5</option>
                    <option selected>10</option>
                    <option>15</option>
                </select>
                <button id="startQuiz">Start</button>
                <button class="ghost" id="retake" disabled>Retake</button>
                <span class="pill" id="scorePill">Score: —</span>
            </div>
            <div id="quizWrap"></div>
        </section>

        <!-- Python Runner (right sidebar) -->
        <section id="runner" class="card">
            <div class="row">
                <h3 style="margin:0">Run Python in your Browser</h3>
                <span class="pill" id="pyStatus">Loading Python…</span>
            </div>
            <div class="muted" style="margin:6px 0 10px">Powered by Pyodide. Press Ctrl+Enter to run.</div>
            <textarea id="pyCode" class="runner" spellcheck="false"># Python runs in your browser using Pyodide!
print("Hello from Python 👋")

# Basics, conditionals, loops, functions, exceptions demo
def fizzbuzz(n):
    out = []
    for i in range(1, n+1):
        if i % 15 == 0:
            out.append("FizzBuzz")
        elif i % 3 == 0:
            out.append("Fizz")
        elif i % 5 == 0:
            out.append("Buzz")
        else:
            out.append(str(i))
    return out

print(", ".join(fizzbuzz(15)))

def safe_div(a, b):
    return a / b

try:
    print("9 / 3 =", safe_div(9, 3))
    print("1 / 0 =", safe_div(1, 0))  # raises ZeroDivisionError
except ZeroDivisionError as e:
    print("Caught:", e)</textarea>
            <div class="row" style="margin-top:8px">
                <button id="runPy">Run (Ctrl+Enter)</button>
                <button class="ghost" id="clearOut">Clear Output</button>
            </div>
            <pre id="pyOut" aria-live="polite"></pre>
        </section>
    </main>

    <script>
        // Data
        const ITEMS = [
            // Basics & Console
            { u: 'basics', t: 'print()', d: 'Outputs text or values to the console.', code: `print("Hello", 3+2)`, out: `Hello 5` },
            { u: 'basics', t: 'Variables', d: 'Names that store values. Python is dynamically typed.', code: `name = "Kai"\nage = 16`, out: `(stores values)` },
            { u: 'basics', t: 'input()', d: 'Reads a line of text from the user as a string.', code: `x = input("Enter a number: ")\nprint(type(x))`, out: `<class 'str'>` },
            { u: 'basics', t: 'Type Conversion', d: 'Convert strings to numbers with int() or float().', code: `n = int("42")\nx = float("3.5")\nprint(n + x)`, out: `45.5` },
            { u: 'basics', t: 'String Formatting (f-strings)', d: 'Embed values inside strings using f"...".', code: `name="Ari"; score=9\nprint(f"{name} scored {score}/10")`, out: `Ari scored 9/10` },
            { u: 'basics', t: 'Operators', d: 'Math: + - * / // % **  Comparison: == != < <= > >=', code: `print(7//3, 7%3, 2**3)`, out: `2 1 8` },
            { u: 'basics', t: 'Comments', d: 'Anything after # on a line is ignored by Python.', code: `# todo: refactor\nprint("ok")`, out: `ok` },

            // Conditionals
            { u: 'conds', t: 'if / elif / else', d: 'Run code based on conditions; first true branch runs.', code: `x=5\nif x>5:\n  print("A")\nelif x==5:\n  print("B")\nelse:\n  print("C")`, out: `B` },
            { u: 'conds', t: 'Comparison Operators', d: '== != < > <= >= compare values.', code: `print(3!=4, 2<=2)`, out: `True True` },
            { u: 'conds', t: 'Logical Operators', d: 'and, or, not combine conditions.', code: `rain=True; busy=False\nprint(rain and busy, rain or busy, not busy)`, out: `False True True` },
            { u: 'conds', t: 'Nested Conditionals', d: 'if inside another if for multi-step checks.', code: `age=17\nif age>=16:\n  if age>=18: print("adult")\n  else: print("teen")`, out: `teen` },
            { u: 'conds', t: 'Chained Comparisons', d: 'Math-style chaining like 1 < x <= 10.', code: `x=7\nprint(1<x<=10)`, out: `True` },

            // Looping
            { u: 'loops', t: 'for with range()', d: 'Repeat a fixed number of times.', code: `for i in range(3):\n  print(i)`, out: `0\n1\n2` },
            { u: 'loops', t: 'Iterating a List', d: 'Loop through each element in an iterable.', code: `nums=[3,5,2]\nfor n in nums:\n  print(n*2)`, out: `6\n10\n4` },
            { u: 'loops', t: 'while Loop', d: 'Repeat while a condition is true.', code: `n=3\nwhile n>0:\n  print(n)\n  n-=1`, out: `3\n2\n1` },
            { u: 'loops', t: 'break', d: 'Exit the nearest loop early.', code: `for c in "python":\n  if c=="h": break\n  print(c)`, out: `p\ny\nt` },
            { u: 'loops', t: 'continue', d: 'Skip to next iteration.', code: `for i in range(5):\n  if i%2==0: continue\n  print(i)`, out: `1\n3` },
            { u: 'loops', t: 'Accumulator', d: 'Add up or combine values while looping.', code: `total=0\nfor x in [2,4,6]:\n  total+=x\nprint(total)`, out: `12` },

            // Functions & Exceptions
            { u: 'funcs', t: 'def and return', d: 'Define a function; return gives a result.', code: `def add(a,b):\n  return a+b\nprint(add(2,3))`, out: `5` },
            { u: 'funcs', t: 'Parameters & Arguments', d: 'Inputs a function takes (positional or keyword).', code: `def greet(name,msg="Hi"):\n  print(msg, name)\ngreet("Kai"); greet("Zoe", msg="Hey")`, out: `Hi Kai\nHey Zoe` },
            { u: 'funcs', t: 'Scope (local vs global)', d: 'Variables in functions are local unless declared global.', code: `x=5\ndef f():\n  x=9\n  print(x)\nf(); print(x)`, out: `9\n5` },
            { u: 'funcs', t: 'Docstring', d: 'Triple-quoted string under def describing the function.', code: `def area(r):\n  """Returns circle area."""\n  return 3.14*r*r`, out: `(docstring example)` },
            { u: 'funcs', t: 'try / except', d: 'Handle errors to keep program running.', code: `try:\n  n=int("hi")\nexcept ValueError:\n  print("bad number")`, out: `bad number` },
            { u: 'funcs', t: 'raise', d: 'Create an error on purpose when input is invalid.', code: `def half(n):\n  if n%2: raise ValueError("odd")\n  return n//2\nprint(half(4))`, out: `2` },
            { u: 'funcs', t: 'Multiple except', d: 'Catch specific exceptions first.', code: `try:\n  x=int("3.2")\nexcept ValueError:\n  print("value error")\nexcept Exception:\n  print("other")`, out: `value error` },
        ];
        // Utils
        const $ = s => document.querySelector(s);
        const $$ = s => Array.from(document.querySelectorAll(s));
        const shuffle = a => { for (let i = a.length - 1; i > 0; i--) { const j = (Math.random() * (i + 1)) | 0;[a[i], a[j]] = [a[j], a[i]]; } return a; };
        const unitNames = { basics: 'Basics & Console', conds: 'Conditionals', loops: 'Looping', funcs: 'Functions & Exceptions' };
        function escapeHtml(s) { return String(s).replace(/[&<>]/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;' }[c])); }

        // Theme handling
        function applyTheme(theme) {
            if (!theme || theme === 'system') {
                document.body.removeAttribute('data-theme');
            } else {
                document.body.setAttribute('data-theme', theme);
            }
            try { localStorage.setItem('gciTheme', theme || 'system'); } catch (_) { }
        }
        (function initTheme() {
            const saved = (function () { try { return localStorage.getItem('gciTheme'); } catch (_) { return null; } })() || 'system';
            const sel = document.getElementById('themeSelect');
            if (sel) {
                sel.value = saved;
                sel.addEventListener('change', function () { applyTheme(this.value); });
            }
            applyTheme(saved);
        })();

        // Tabs
        $$('.tab').forEach(btn => {
            btn.addEventListener('click', () => {
                $$('.tab').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const mode = btn.dataset.mode;
                ['study', 'flash', 'match', 'quiz'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.toggle('hide', id !== mode);
                });
                if (mode === 'flash') initFlash();
                if (mode === 'match') initMatch();
            });
        });

        // Filter
        let unitFilter = 'all';
        $('#unitFilter').addEventListener('change', (e) => {
            unitFilter = e.target.value || 'all';
            renderStudy($('#search').value || '');
            initFlash(true);
        });

        // Study
        const studyList = $('#studyList');
        function filtered() { return ITEMS.filter(it => unitFilter === 'all' || it.u === unitFilter); }
        function renderStudy(filter = '') {
            const q = (filter || '').toLowerCase();
            const src = filtered().filter(x =>
                !q || x.t.toLowerCase().includes(q) || x.d.toLowerCase().includes(q) ||
                (x.code || '').toLowerCase().includes(q) || (x.out || '').toLowerCase().includes(q)
            );
            $('#countPill').textContent = `${src.length} items`;
            studyList.innerHTML = src.map(x => `
            <div class="item">
              <h3>${x.t} <span class="pill" style="margin-left:6px">${unitNames[x.u] || ''}</span></h3>
              <div class="muted">${x.d}</div>
              ${x.code ? `
                <pre><code class="lang-py">${escapeHtml(x.code)}</code></pre>
                <div class="row" style="margin-top:6px">
                  <button class="open-runner" data-code="${encodeURIComponent(x.code)}">Open in Runner</button>
                </div>
              `: ''}
              ${x.out && x.out !== '(stores values)' && x.out !== '(docstring example)' ? `<div><strong>Output:</strong><pre><code>${escapeHtml(x.out)}</code></pre></div>` : ''}
            </div>
          `).join('');
        }
        renderStudy();
        $('#search').addEventListener('input', e => renderStudy(e.target.value));
        $('#expandAll').addEventListener('click', () => renderStudy($('#search').value));
        $('#collapseAll').addEventListener('click', () => {
            const q = ($('#search').value || '').toLowerCase();
            const src = filtered().filter(x => !q || x.t.toLowerCase().includes(q));
            $('#countPill').textContent = `${src.length} items`;
            studyList.innerHTML = src.map(x => `
            <div class="item toggle">
              <h3>${x.t} <span class="pill" style="margin-left:6px">${unitNames[x.u] || ''}</span></h3>
              <div class="muted hide">${x.d}</div>
              ${x.code ? `
                <pre class="hide"><code class="lang-py">${escapeHtml(x.code)}</code></pre>
                <div class="row hide" style="margin-top:6px">
                  <button class="open-runner" data-code="${encodeURIComponent(x.code)}">Open in Runner</button>
                </div>
              `: ''}
              ${x.out && x.out !== '(stores values)' && x.out !== '(docstring example)' ? `<div class="hide"><strong>Output:</strong><pre><code>${escapeHtml(x.out)}</code></pre></div>` : ''}
            </div>
          `).join('');
            $$('#study .toggle').forEach(it => {
                it.addEventListener('click', () => {
                    it.querySelectorAll('.muted, pre, div .hide, .hide').forEach(n => n.classList.toggle('hide'));
                });
            });
        });

        // Flashcards
        let order = [], idx = 0, flipped = false, learned = new Set();
        function initFlash(reset = false) {
            const src = filtered();
            order = src.map((_, i) => i);
            if (reset) { idx = 0; flipped = false; }
            updateCard();
        }
        function updateCard() {
            const src = filtered();
            if (!src.length) { $('#front').textContent = 'No items'; $('#back').classList.add('hide'); return; }
            const it = src[order[idx]];
            $('#front').innerHTML = `<div class="term">${it.t}</div><div class="muted" style="margin-top:6px">${unitNames[it.u] || ''}</div>`;
            const back = `
            <div class="defBig">${it.d}</div>
            ${it.code ? `
              <pre style="margin-top:10px"><code>${escapeHtml(it.code)}</code></pre>
              <div class="row" style="margin-top:6px">
                <button class="open-runner" data-code="${encodeURIComponent(it.code)}">Open in Runner</button>
              </div>
            `: ''}
            ${it.out && it.out !== '(stores values)' && it.out !== '(docstring example)' ? `<div style="margin-top:6px"><strong>Output:</strong><pre><code>${escapeHtml(it.out)}</code></pre></div>` : ''}
          `;
            $('#back').innerHTML = back;
            $('#front').classList.toggle('hide', flipped);
            $('#back').classList.toggle('hide', !flipped);
            $('#fcProg').textContent = `${idx + 1} / ${order.length}`;
            $('#gotPill').textContent = `Got it: ${learned.size}`;
        }
        $('#flip').addEventListener('click', () => { flipped = !flipped; updateCard(); });
        $('#fcBox').addEventListener('click', () => { flipped = !flipped; updateCard(); });
        document.addEventListener('keydown', (e) => {
            if ($('#flash').classList.contains('hide')) return;
            if (e.key === 'f' || e.key === 'F') { flipped = !flipped; updateCard(); }
            if (e.key === 'n' || e.key === 'ArrowRight') { idx = (idx + 1) % order.length; flipped = false; updateCard(); }
            if (e.key === 'p' || e.key === 'ArrowLeft') { idx = (idx - 1 + order.length) % order.length; flipped = false; updateCard(); }
        });
        $('#next').addEventListener('click', () => { idx = (idx + 1) % order.length; flipped = false; updateCard(); });
        $('#prev').addEventListener('click', () => { idx = (idx - 1 + order.length) % order.length; flipped = false; updateCard(); });
        $('#shuffle').addEventListener('click', () => { order = shuffle(order); idx = 0; flipped = false; updateCard(); });
        $('#gotIt').addEventListener('click', () => {
            const key = `${unitFilter}:${order[idx]}`;
            learned.add(key);
            $('#gotPill').textContent = `Got it: ${learned.size}`;
            idx = (idx + 1) % order.length; flipped = false; updateCard();
        });
        $('#resetGot').addEventListener('click', () => { learned.clear(); $('#gotPill').textContent = 'Got it: 0'; });

        // Matching
        let selL = null, selR = null, pairs = new Set();
        function initMatch() {
            const srcAll = filtered();
            const pick = shuffle(srcAll.map((t, i) => ({ i, t }))).slice(0, Math.min(6, srcAll.length));
            const left = pick.map(p => ({ i: p.i, text: p.t.t }));
            const right = shuffle(pick.map(p => ({ i: p.i, text: p.t.d })));
            $('#leftCol').innerHTML = left.map(l => `<div class="chip" data-i="${l.i}">${srcAll[l.i].t}</div>`).join('');
            $('#rightCol').innerHTML = right.map(r => `<div class="chip" data-i="${r.i}">${srcAll[r.i].d}</div>`).join('');
            $('#matchLeft').textContent = `Pairs left: ${left.length}`;
            pairs = new Set(pick.map(p => p.i));
            selL = selR = null;

            $$('#leftCol .chip').forEach(c => c.addEventListener('click', () => {
                if (c.classList.contains('ok')) return;
                $$('#leftCol .chip').forEach(x => x.classList.remove('sel'));
                selL = Number(c.dataset.i);
                c.classList.add('sel'); tryPair();
            }));
            $$('#rightCol .chip').forEach(c => c.addEventListener('click', () => {
                if (c.classList.contains('ok')) return;
                $$('#rightCol .chip').forEach(x => x.classList.remove('sel'));
                selR = Number(c.dataset.i);
                c.classList.add('sel'); tryPair();
            }));

            function tryPair() {
                if (selL === null || selR === null) return;
                const leftEl = document.querySelector('#leftCol .chip.sel');
                const rightEl = document.querySelector('#rightCol .chip.sel');
                if (!leftEl || !rightEl) return;
                if (selL === selR) {
                    leftEl.classList.remove('sel'); rightEl.classList.remove('sel');
                    leftEl.classList.add('ok'); rightEl.classList.add('ok');
                    pairs.delete(selL);
                    $('#matchLeft').textContent = `Pairs left: ${pairs.size}`;
                    if (pairs.size === 0) $('#matchLeft').textContent = 'All matched! 🎉';
                } else {
                    rightEl.classList.add('bad');
                    setTimeout(() => rightEl.classList.remove('bad'), 350);
                    $$('#leftCol .chip.sel, #rightCol .chip.sel').forEach(x => x.classList.remove('sel'));
                }
                selL = selR = null;
            }
        }
        $('#newRound').addEventListener('click', initMatch);

        // Quiz helpers: unique options with 1 correct
        function pickWrongTerms(correct, count) {
            const pool = ITEMS.map(x => x.t).filter(t => t !== correct);
            return shuffle(pool).slice(0, count);
        }
        function pickWrongOutputs(correct, count) {
            const pool = ITEMS.map(x => x.out).filter(s => s && !s.startsWith('(')).map(s => String(s).replace(/\r\n/g, '\n'));
            const uniq = Array.from(new Set(pool.filter(s => s !== correct)));
            return shuffle(uniq).slice(0, count);
        }
        function buildOptions(correct, candidates, count, fallbackFn) {
            const wrongs = []; const seen = new Set([String(correct)]);
            for (const c of candidates) {
                const s = String(c); if (!s || seen.has(s)) continue;
                seen.add(s); wrongs.push(s); if (wrongs.length === count) break;
            }
            if (wrongs.length < count && typeof fallbackFn === 'function') {
                const extra = fallbackFn(String(correct), count - wrongs.length);
                for (const e of extra) {
                    const s = String(e); if (!s || seen.has(s)) continue;
                    seen.add(s); wrongs.push(s); if (wrongs.length === count) break;
                }
            }
            return shuffle([String(correct), ...wrongs.slice(0, count)]);
        }

        // Quiz — build all questions, submit once
        function mkQuestions(n) {
            const pool = shuffle(filtered().slice()).slice(0, n);
            return pool.map(item => {
                const canOut = item.code && item.out && !String(item.out).startsWith('(');
                const type = canOut && Math.random() < 0.5 ? 'out' : 'def';
                if (type === 'def') {
                    const correct = item.t;
                    const candidates = shuffle(ITEMS.filter(x => x.t !== correct)).map(x => x.t);
                    const opts = buildOptions(correct, candidates, 3, pickWrongTerms);
                    return { type, prompt: 'Which term fits this definition?', detail: item.d, correct, opts };
                } else {
                    const correctOut = String(item.out || '').replace(/\r\n/g, '\n');
                    const d1 = correctOut.trimEnd() === correctOut ? (correctOut + ' ') : correctOut.trimEnd();
                    const d2 = correctOut.replace(/\b(True|False)\b/g, m => (m === 'True' ? 'False' : 'True'));
                    const d3 = correctOut.includes('\n') ? correctOut.split('\n').slice(0, -1).join('\n') : (correctOut + '\n');
                    const candidates = shuffle([d1, d2, d3]);
                    const opts = buildOptions(correctOut, candidates, 3, pickWrongOutputs);
                    return { type, prompt: 'What is the output of this code?', detail: `\n${item.code}`, correct: correctOut, opts };
                }
            });
        }
        function renderQuiz(n = 10) {
            const qs = mkQuestions(n);
            const wrap = document.getElementById('quizWrap');
            wrap.innerHTML = qs.map((q, qi) => `
            <div class="q card" style="padding:12px; margin-top:8px">
              <div><strong>Q${qi + 1}.</strong> ${q.prompt}</div>
              ${q.type === 'def'
                    ? `<div class="muted" style="margin:6px 0 10px">${escapeHtml(q.detail)}</div>`
                    : `<pre style="margin:6px 0 10px"><code>${escapeHtml(q.detail)}</code></pre>`}
              ${q.opts.map(opt => `
                <label class="opt">
                  <input type="radio" name="q${qi}" value="${escapeHtml(opt)}"/>
                  ${q.type === 'def' ? escapeHtml(opt) : `<pre style="margin:0"><code>${escapeHtml(opt)}</code></pre>`}
                </label>
              `).join('')}
            </div>
          `).join('');
            document.getElementById('startQuiz').disabled = true;
            document.getElementById('retake').disabled = true;
            document.getElementById('scorePill').textContent = 'Score: —';

            const submit = document.createElement('button');
            submit.textContent = 'Submit';
            submit.id = 'submitQuiz';
            submit.style.marginTop = '10px';
            submit.addEventListener('click', () => {
                let score = 0;
                qs.forEach((q, qi) => {
                    const sel = wrap.querySelector(`input[name="q${qi}"]:checked`);
                    const val = sel ? sel.value.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&') : null;
                    const options = Array.from(wrap.querySelectorAll(`input[name="q${qi}"]`));
                    options.forEach(r => {
                        const rv = r.value.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
                        if (rv === q.correct) r.closest('.opt').classList.add('good');
                        if (sel && r === sel && rv !== q.correct) r.closest('.opt').classList.add('bad');
                        r.disabled = true;
                    });
                    if (val === q.correct) score++;
                });
                document.getElementById('scorePill').textContent = `Score: ${score}/${qs.length}`;
                document.getElementById('retake').disabled = false;
                submit.disabled = true;
            });
            wrap.appendChild(submit);
        }
        document.getElementById('startQuiz').addEventListener('click', () => {
            const n = Number(document.getElementById('quizCount').value || '10');
            renderQuiz(n);
        });
        document.getElementById('retake').addEventListener('click', () => {
            document.getElementById('startQuiz').disabled = false;
            document.getElementById('quizWrap').innerHTML = '';
            document.getElementById('scorePill').textContent = 'Score: —';
            document.getElementById('retake').disabled = true;
        });

        // Delegated: Open example code in runner
        document.addEventListener('click', (e) => {
            const btn = e.target.closest ? e.target.closest('.open-runner') : null;
            if (!btn) return;
            const code = decodeURIComponent(btn.dataset.code || '');
            const ta = document.getElementById('pyCode');
            if (ta) { ta.value = code; }
            const runnerEl = document.getElementById('runner');
            if (runnerEl) { runnerEl.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
        });

        // ===== Python Runner (Pyodide) =====
        let pyodide = null;
        const pyStatus = document.getElementById('pyStatus');
        const pyOut = document.getElementById('pyOut');
        const pyCodeEl = document.getElementById('pyCode');

        function appendOut(text) {
            if (pyOut) {
                pyOut.textContent += text;
                pyOut.scrollTop = pyOut.scrollHeight;
            }
        }
        async function ensurePyodide() {
            if (pyodide) return pyodide;
            if (pyStatus) pyStatus.textContent = 'Downloading…';
            if (typeof loadPyodide !== 'function') throw new Error('Pyodide not loaded');
            pyodide = await loadPyodide({
                indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.24.1/full/',
                stdout: (t) => appendOut(t + '\n'),
                stderr: (t) => appendOut(t + '\n'),
            });
            if (pyodide.setStdin) {
                pyodide.setStdin({ stdin: () => (window.prompt('Python input() — enter a line:') ?? '') + '\n' });
            }
            if (pyStatus) pyStatus.textContent = 'Ready';
            return pyodide;
        }
        async function runPython(code) {
            const py = await ensurePyodide();
            try {
                await py.runPythonAsync(code);
            } catch (err) {
                appendOut(String(err) + '\n');
            }
        }
        document.getElementById('runPy').addEventListener('click', () => {
            pyOut.textContent = '';
            runPython(pyCodeEl.value);
        });
        document.getElementById('clearOut').addEventListener('click', () => { pyOut.textContent = ''; });
        pyCodeEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                pyOut.textContent = '';
                runPython(pyCodeEl.value);
            }
        });
        ensurePyodide().catch(() => { if (pyStatus) pyStatus.textContent = 'Failed to load'; });
        // ===== end Python Runner =====
    </script>
</body>

</html>